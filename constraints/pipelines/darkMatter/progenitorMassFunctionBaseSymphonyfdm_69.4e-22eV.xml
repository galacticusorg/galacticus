<?xml version="1.0" encoding="UTF-8"?>
<!-- Parameters for Symphony Milky Way progenitor mass function constraints -->
<!-- 23-November-2020                                                       -->
<parameters>
  <formatVersion>2</formatVersion>
  <version>0.9.4</version>
  
  <!-- Include parameters -->
  <xi:include href="haloMassFunctionParameters.xml" xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="simulation_Symphony_MilkyWay.xml"        xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="cosmology_Symphony.xml"         xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="transferFunction_Symphony_fdm_69.4e-22eV.xml"     xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="progenitorMassFunctionParameters.xml" xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="progenitorMassFunctionResolution.xml" xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>
  <xi:include href="mergerTreeEvolution.xml"        xpointer="xpointer(parameters/*)" xmlns:xi="http://www.w3.org/2001/XInclude"/>

  <!-- Task control -->
  <evolveForestsWorkShare value="cyclic"/>

  <!-- Distribution of merger tree masses to build -->
  <mergerTreeBuildMasses value="replicate">
    <replicationCount value="100"/>
    <mergerTreeBuildMasses value="readHDF5">
      <fileName value="%DATASTATICPATH%/darkMatter/haloMasses_Symphony_MilkyWay_fdm_69.4e-22eV.hdf5"/>
    </mergerTreeBuildMasses>
  </mergerTreeBuildMasses>
  <mergerTreeMassResolution value="fixed">
    <!-- 1/5th of 300 times the particle mass - such that our resolution is well below any mass scale that we care about -->
    <massResolution value="=[simulation::massParticle]*300.0/5.0"/>
  </mergerTreeMassResolution>

  <!-- Output options -->
  <outputFileName  value="Symphonyfdm_69.4e-22eV.hdf5"/>
  <mergerTreeOutputter value="analyzer"/>
  <outputTimes value="list">
    <!-- Matched to Symphony snapshots -->
    <redshifts value="0.503691562786641 0.990485479408428 2.03149725649498 3.98405103668262"/>
  </outputTimes>
  <mergerTreeOperator value="regridTimes">
    <!-- Regrid the trees to massively speed up searching for parents etc. -->
    <outputTimes value="list">
      <!-- Matched to Symphony snapshots -->
      <redshifts value="0.0 0.503691562786641 0.990485479408428 2.03149725649498 3.98405103668262 9.0"/>
    </outputTimes>
  </mergerTreeOperator>
  <outputAnalysis value="multi">
    <!-- Minimum mass ratio for likelihood is the ratio of the Symphony 300 particle mass limit to the minimum parent
         mass in the sample. -->
    <virialDensityContrastDefinition value="sphericalCollapseClsnlssMttrCsmlgclCnstnt"/>
    <outputAnalysis value="progenitorMassFunction">
      <fileName                     value="%DATASTATICPATH%/darkMatter/progenitorMassFunctions_Symphony_MilkyWay_fdm_69.4e-22eV.hdf5"/>
      <indexParent                  value="2"                                                                                        />
      <indexRedshift                value="0"                                                                                        />
      <massRatioLikelihoodMinimum value="=([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]*step([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]-1e-5*1e12)+1e-5*1e12*step(-[simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]+1e-5*1e12))/10.0^12.0"/>
      <massRatioLikelihoodMaximum   value="1.00"                                                                                     />
      <covarianceDiagonalize        value="true"                                                                                     />
      <covarianceTargetOnly         value="true"                                                                                     />
      <likelihoodInLog              value="true"                                                                                     />
      <rootVarianceTargetFractional value="=[progenitorMassFunctionParameters::rootVarianceTargetFractional]" 			     />
      <alwaysIsolatedOnly           value="true"                                                                                     />
      <redshiftParent               value="0.0"                                                                                      />
      <comment                      value="$12.00 &lt; \log_{10}(M_\mathrm{parent}/\mathrm{M}_\odot) \le 12.50$; $z=0.51$; Symphony halos"/>
      <label                        value="Symphony_MilkywayM2Z0"                                                                    />
      <targetLabel                  value="Nadler et al. (2022)"                                                                     />
    </outputAnalysis>    
    <outputAnalysis value="progenitorMassFunction">
      <fileName                     value="%DATASTATICPATH%/darkMatter/progenitorMassFunctions_Symphony_MilkyWay_fdm_69.4e-22eV.hdf5"/>
      <indexParent                  value="2"                                                                                        />
      <indexRedshift                value="1"                                                                                        />
      <massRatioLikelihoodMinimum value="=([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]*step([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]-1e-5*1e12)+1e-5*1e12*step(-[simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]+1e-5*1e12))/10.0^12.0"/>
      <massRatioLikelihoodMaximum   value="1.00"                                                                                     />
      <covarianceDiagonalize        value="true"                                                                                     />
      <covarianceTargetOnly         value="true"                                                                                     />
      <likelihoodInLog              value="true"                                                                                     />
      <rootVarianceTargetFractional value="=[progenitorMassFunctionParameters::rootVarianceTargetFractional]" 			     />
      <alwaysIsolatedOnly           value="true"                                                                                     />
      <redshiftParent               value="0.0"                                                                                      />
      <comment                      value="$12.00 &lt; \log_{10}(M_\mathrm{parent}/\mathrm{M}_\odot) \le 12.50$; $z=1.00$; Symphony halos"/>
      <label                        value="Symphony_MilkywayM2Z1"                                                                    />
      <targetLabel                  value="Nadler et al. (2022)"                                                                     />
    </outputAnalysis>    
    <outputAnalysis value="progenitorMassFunction">
      <fileName                     value="%DATASTATICPATH%/darkMatter/progenitorMassFunctions_Symphony_MilkyWay_fdm_69.4e-22eV.hdf5"/>
      <indexParent                  value="2"                                                                                        />
      <indexRedshift                value="2"                                                                                        />
      <massRatioLikelihoodMinimum value="=([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]*step([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]-1e-5*1e12)+1e-5*1e12*step(-[simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]+1e-5*1e12))/10.0^12.0"/>
      <massRatioLikelihoodMaximum   value="1.00"                                                                                     />
      <covarianceDiagonalize        value="true"                                                                                     />
      <covarianceTargetOnly         value="true"                                                                                     />
      <likelihoodInLog              value="true"                                                                                     />
      <rootVarianceTargetFractional value="=[progenitorMassFunctionParameters::rootVarianceTargetFractional]" 			     />
      <alwaysIsolatedOnly           value="true"                                                                                     />
      <redshiftParent               value="0.0"                                                                                      />
      <comment                      value="$12.00 &lt; \log_{10}(M_\mathrm{parent}/\mathrm{M}_\odot) \le 12.50$; $z=2.03$; Symphony halos"/>
      <label                        value="Symphony_MilkywayM2Z2"                                                                    />
      <targetLabel                  value="Nadler et al. (2022)"                                                                     />
    </outputAnalysis>    
    <outputAnalysis value="progenitorMassFunction">
      <fileName                     value="%DATASTATICPATH%/darkMatter/progenitorMassFunctions_Symphony_MilkyWay_fdm_69.4e-22eV.hdf5"/>
      <indexParent                  value="2"                                                                                        />
      <indexRedshift                value="3"                                                                                        />
      <massRatioLikelihoodMinimum value="=([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]*step([simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]-1e-5*1e12)+1e-5*1e12*step(-[simulation::massParticle]*[resolution::progenitorHaloParticleCountMinimum]+1e-5*1e12))/10.0^12.0"/>
      <massRatioLikelihoodMaximum   value="1.00"                                                                                     />
      <covarianceDiagonalize        value="true"                                                                                     />
      <covarianceTargetOnly         value="true"                                                                                     />
      <likelihoodInLog              value="true"                                                                                     />
      <rootVarianceTargetFractional value="=[progenitorMassFunctionParameters::rootVarianceTargetFractional]" 			     />
      <alwaysIsolatedOnly           value="true"                                                                                     />
      <redshiftParent               value="0.0"                                                                                      />
      <comment                      value="$12.00 &lt; \log_{10}(M_\mathrm{parent}/\mathrm{M}_\odot) \le 12.50$; $z=3.98$; Symphony halos"/>
      <label                        value="Symphony_MilkywayM2Z3"                                                                    />
      <targetLabel                  value="Nadler et al. (2022)"                                                                     />
    </outputAnalysis>    
  </outputAnalysis>
  <nbodyHaloMassError value="trenti2010">
    <massParticle                value="=[simulation::massParticle]"/> <!-- Particle mass in Symphony -->
    <correlationNormalization    value="1.0"   />
    <correlationMassExponent     value="1.0"   />
    <correlationRedshiftExponent value="0.0"   />
  </nbodyHaloMassError>
  
</parameters>
