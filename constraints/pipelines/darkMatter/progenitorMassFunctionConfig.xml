<?xml version="1.0" encoding="UTF-8"?>
<parameters>
  <!-- Posterior sampling simulation parameter file for constraining parameters of the PCH+ algorithm to MDPL and Symphony simulations -->
  <!-- Andrew Benson (24-Novemer-2020)                                                                                                    -->

  <formatVersion>2</formatVersion>
  <lastModified revision="65c7326e2d0e0e85feea12ef933222871f069fb2" time="2025-06-10T15:59:50"/>

  <verbosityLevel value="standard"/>
  <errorWaitTime  value="0"       />

  <task value="posteriorSample">
    <initializeNodeClassHierarchy value="false"/>
  </task>

  <outputFileName value="chains/galacticus.hdf5"/>
  
  <posteriorSampleLikelihood value="independentLikelihoods">

    <!-- HugeMDPL -->
    <parameterMap         value="mergerTreeBranchingProbability/G0 mergerTreeBranchingProbability/gamma1 mergerTreeBranchingProbability/gamma2 mergerTreeBranchingProbability/gamma3"/>
    <parameterInactiveMap value=""                                                                                                                                                       />
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipeline/darkMatter/progenitorMassFunctionBaseHugeMDPL.xml"/>
      <randomize              value="false"                                                                            />
      <cpuLimit               value="7200"                                                                             />
      <evolveForestsVerbosity value="silent"                                                                           />
    </posteriorSampleLikelihood>

    <!-- BigMDPL -->
    <parameterMap         value="mergerTreeBranchingProbability/G0 mergerTreeBranchingProbability/gamma1 mergerTreeBranchingProbability/gamma2 mergerTreeBranchingProbability/gamma3"/>
    <parameterInactiveMap value=""                                                                                                                                                       />
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipeline/darkMatter/progenitorMassFunctionBaseBigMDPL.xml"/>
      <randomize              value="false"                                                                           />
      <cpuLimit               value="7200"                                                                            />
      <evolveForestsVerbosity value="silent"                                                                          />
    </posteriorSampleLikelihood>

    <!-- MDPL2 -->
    <parameterMap         value="mergerTreeBranchingProbability/G0 mergerTreeBranchingProbability/gamma1 mergerTreeBranchingProbability/gamma2 mergerTreeBranchingProbability/gamma3"/>
    <parameterInactiveMap value=""                                                                                                                                                       />
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipeline/darkMatter/progenitorMassFunctionBaseMDPL2.xml"/>
      <randomize              value="false"                                                                         />
      <cpuLimit               value="7200"                                                                          />
      <evolveForestsVerbosity value="silent"                                                                        />
    </posteriorSampleLikelihood>

    <!-- SMDPL -->
    <parameterMap         value="mergerTreeBranchingProbability/G0 mergerTreeBranchingProbability/gamma1 mergerTreeBranchingProbability/gamma2 mergerTreeBranchingProbability/gamma3"/>
    <parameterInactiveMap value=""                                                                                                                                                       />
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipeline/darkMatter/progenitorMassFunctionBaseSMDPL.xml"/>
      <randomize              value="false"                                                                         />
      <cpuLimit               value="7200"                                                                          />
      <evolveForestsVerbosity value="silent"                                                                        />
    </posteriorSampleLikelihood>

    <!-- VSMDPL -->
    <parameterMap         value="mergerTreeBranchingProbability/G0 mergerTreeBranchingProbability/gamma1 mergerTreeBranchingProbability/gamma2 mergerTreeBranchingProbability/gamma3"/>
    <parameterInactiveMap value=""                                                                                                                                                       />
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipeline/darkMatter/progenitorMassFunctionBaseVSMDPL.xml"/>
      <randomize              value="false"                                                                          />
      <cpuLimit               value="7200"                                                                           />
      <evolveForestsVerbosity value="silent"                                                                         />
    </posteriorSampleLikelihood>

    <!-- Symphony Milky Way -->
    <parameterMap         value="mergerTreeBranchingProbability::G0 mergerTreeBranchingProbability::gamma1 mergerTreeBranchingProbability::gamma2 mergerTreeBranchingProbability::gamma3"/>
    <parameterInactiveMap value=""/>
    <posteriorSampleLikelihood value="galaxyPopulation">
      <baseParametersFileName value="%EXECPATH%/constraints/pipelines/darkMatter/progenitorMassFunctionBaseSymphonyMilkyWay.xml"/>
      <randomize              value="false"                                                                                    />
      <cpuLimit               value="7200"                                                                                     />
      <evolveForestsVerbosity value="silent"                                                                                   />
    </posteriorSampleLikelihood>

  </posteriorSampleLikelihood>

  <!-- MCMC -->
  <posteriorSampleSimulation value="differentialEvolution">
    <stepsMaximum           value="  4000"/>
    <acceptanceAverageCount value="    10"/>
    <stateSwapCount         value="    10"/>
    <logFileRoot            value="chains/chains"/>
    <reportCount            value="    10"/>
    <sampleOutliers         value="false" />
    <logFlushCount          value="     1"/>

    <posteriorSampleState value="correlation">
      <acceptedStateCount value="100"/>
    </posteriorSampleState>

    <posteriorSampleStateInitialize value="latinHypercube">
      <maximinTrialCount value="100"/>
    </posteriorSampleStateInitialize>
    
    <posteriorSampleConvergence value="gelmanRubin">
      <thresholdHatR              value=" 1.20"/>
      <burnCount                  value="10"   />
      <testCount                  value="20"   />
      <outlierCountMaximum        value=" 3"   />
      <outlierSignificance        value=" 0.95"/>
      <outlierLogLikelihoodOffset value="60"   />
      <reportCount                value=" 1"   />
      <logFileName                value="chains/convergence.log"/>
    </posteriorSampleConvergence>
    
    <posteriorSampleStoppingCriterion value="correlationLength">
      <stopAfterCount value="1000"/>
     </posteriorSampleStoppingCriterion>

    <posteriorSampleDffrntlEvltnRandomJump   value="adaptive"/>

    <posteriorSampleDffrntlEvltnProposalSize value="adaptive" >
      <gammaInitial          value="0.50e+0"/>
      <gammaAdjustFactor     value="1.10e+0"/>
      <gammaMinimum          value="1.00e-2"/>
      <gammaMaximum          value="3.00e+0"/>
      <acceptanceRateMinimum value="0.10e+0"/>
      <acceptanceRateMaximum value="0.90e+0"/>
      <updateCount           value="10"     />
    </posteriorSampleDffrntlEvltnProposalSize>
    
    <!-- PCH parameters -->
    <modelParameter value="active">
      <name value="mergerTreeBranchingProbability/G0"/>
      <distributionFunction1DPrior value="uniform">
	<limitLower value="0.10"/>
	<limitUpper value="3.00"/>
      </distributionFunction1DPrior>
      <operatorUnaryMapper value="logarithm"/>
      <distributionFunction1DPerturber value="cauchy">
	<median value="0.0e+0"/>
	<scale  value="1.0e-9"/>
      </distributionFunction1DPerturber>
    </modelParameter>
    
    <modelParameter value="active">
      <name value="mergerTreeBranchingProbability/gamma1"/>
      <distributionFunction1DPrior value="uniform">
	<limitLower value="-1.00"/>
	<limitUpper value="+0.99"/>	<!-- Avoid 1.0 as it leads to a divergence -->
      </distributionFunction1DPrior>
      <operatorUnaryMapper value="identity"/>
      <distributionFunction1DPerturber value="cauchy">
	<median value="0.0e+0"/>
	<scale  value="1.0e-9"/>
      </distributionFunction1DPerturber>
    </modelParameter>
    
    <modelParameter value="active">
      <name value="mergerTreeBranchingProbability/gamma2"/>
      <distributionFunction1DPrior value="uniform">
	<limitLower value="-1.00"/>
	<limitUpper value="+1.00"/>
      </distributionFunction1DPrior>
      <operatorUnaryMapper value="identity"/>
      <distributionFunction1DPerturber value="cauchy">
	<median value="0.0e+0"/>
	<scale  value="1.0e-9"/>
      </distributionFunction1DPerturber>
    </modelParameter>
    
    <modelParameter value="active">
      <name value="mergerTreeBranchingProbability/gamma3"/>
      <distributionFunction1DPrior value="uniform">
	<limitLower value="+0.00"/>
	<limitUpper value="+1.00"/>
      </distributionFunction1DPrior>
      <operatorUnaryMapper value="identity"/>
      <distributionFunction1DPerturber value="cauchy">
	<median value="0.0e+0"/>
	<scale  value="1.0e-9"/>
      </distributionFunction1DPerturber>
    </modelParameter>
    
  </posteriorSampleSimulation>

  <!-- Random number generator with seed offset for each MPI process -->
  <randomNumberGenerator value="GSL">
    <seed          value="9372"/>
    <mpiRankOffset value="true"/>
  </randomNumberGenerator>

</parameters>
