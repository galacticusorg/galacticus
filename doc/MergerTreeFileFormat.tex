\section{Basic File Format}\label{sec:MergerTreeFormatDescription}

Merger trees are stored in HDF5 files for portability and convenience. Additionally, the format is intended to be sufficiently flexible to allow it to desribe merger trees obtained in a wide variety of ways, including Monte Carlo algorithms (e.g. extended Press-Schechter algorithms) and from N-body simulations. 

\subsection{Flexibility and Extensibility}

All of the groups/datasets in the file except for the {\tt treeIndex} and {\tt haloTrees} groups are, in principle, optional. This does not mean that a file created without some of these optional groups/datasets will be useable by a given code. It is the responsibility of a given code to check that all data that it requires is present in the file. You are therefore encouraged to include as much information as possible when constructing merger tree files.

Additionally, the file format is intended to be extensible. It is permissible to add additional datasets, for example to describe some other properties of nodes in each tree. Additional datasets should follow the structure of currently defined datasets, i.e. they should be stored as a single dataset combining all trees with nodes listed in the same order as for other datasets. For additional datasets which might be of general use you are encouraged to \href{mailto:abenson@obs.carnegiescience.edu}{contact us} and recommend them for inclusion in the standard---this allows their name to be standardized.

\subsection{A Note on Scalar Attributes}

Many of the HDF5 attributes discussed in this document are indicated to be scalar (rank 0) attributes. It is allowable within the standard that these be pseudo-scalars (rank 1 arrays contaning a single element). This allows such attributes to be created using the \href{http://www.hdfgroup.org/HDF5/doc/HL/RM_H5LT.html}{\tt h5lt} API for example.

\subsection{Example File Structure}

An example of the structure of such a file, called ``{\tt example.hdf5}'' is shown below using the format of {\tt h5dump}. Each of the groups is described in detail in the following sections.

\begin{verbatim}
HDF5 "example.hdf5" {
GROUP "/" {
   GROUP "cosmology" {
   }
   GROUP "groupFinder" {
   }
   GROUP "haloTrees" {
   }
   GROUP "mergerTrees" {
   }
   GROUP "particles" {
   }
   GROUP "provenance" {
   }
   GROUP "simulation" {
   }
   GROUP "treeIndex" {
   }
   GROUP "units" {
   }
}
\end{verbatim}

\section{Cosmology Group}

The {\tt cosmology} group describes the cosmological model within which the merger trees contained in the file were constructed. An example of this group, showing standard attributes, is given below.

\begin{verbatim}
GROUP "cosmology" {
   ATTRIBUTE "HubbleParam" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.73
      }
   }
   ATTRIBUTE "OmegaMatter" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.25
      }
   }
   ATTRIBUTE "OmegaLambda" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.75
      }
   }
   ATTRIBUTE "OmegaBaryon" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.045
      }
   }
   ATTRIBUTE "powerSpectrumIndex" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 1
      }
   }
   ATTRIBUTE "sigma_8" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.9
      }
   }
   ATTRIBUTE "transferFunction" {
      DATATYPE  H5T_STRING {
            STRSIZE 7;
            STRPAD H5T_STR_SPACEPAD;
            CSET H5T_CSET_ASCII;
            CTYPE H5T_C_S1;
         }
      DATASPACE  SCALAR
      DATA {
      (0): "CMBFast"
      }
   }
}
\end{verbatim}

\subsection{Standard Attributes}

The following are standard attributes in the {\tt cosmology} group (others may be added as desired).

\begin{description}
 \item [{\tt HubbleParam}] The Hubble parameter in units of 100 km/s/Mpc at $z=0$, $h_0$;
 \item [{\tt OmegaMatter}] The density of matter (both dark and baryonic matter) in units of the critical density at $z=0$, $\Omega_{\rm M}$;
 \item [{\tt OmegaLambda}] The density of dark energy in units of the critical density at $z=0$, $\Omega_\Lambda$;
 \item [{\tt OmegaBaryon}] The density of matter (both dark and baryonic matter) in units of the critical density at $z=0$, $\Omega_{\rm b}$;
 \item [{\tt powerSpectrumIndex}] The index of the primordial power spectrum of matter fluctuations, i.e. $n_{\rm s}$ for power spectrum $P(k) \propto k^{n_{\rm s}}$;
 \item [{\tt sigma\_8}] The root-variance of mass fluctuations in real space top-hat spheres of radius $8h^{-1}$Mpc computed from the $z=0$ linear theory power spectrum, $\sigma_8$;
 \item [{\tt transferFunction}] A descriptor of the transfer function used to compute the power spectrum.
\end{description}

\section{Group Finder Group}

This group, typically relevant only for merger trees derived from N-body simulations, describes the characteristics of the group finding algorithm that was used to find halos in the simulation. An example of this group, showing standard attributes, is given below.

\begin{verbatim}
GROUP "groupFinder" {
   COMMENT "Group finder parameters."
   ATTRIBUTE "code" {
      DATATYPE  H5T_STRING {
            STRSIZE 7;
            STRPAD H5T_STR_SPACEPAD;
            CSET H5T_CSET_ASCII;
            CTYPE H5T_C_S1;
         }
      DATASPACE  SCALAR
      DATA {
      (0): "SUBFIND"
      }
   }
   ATTRIBUTE "linkingLength" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.2
      }
   }
   ATTRIBUTE "minimumParticleNumber" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 20
      }
   }
}
\end{verbatim}

\subsection{Standard Attributes}

The following are standard attributes in the {\tt groupFinder} group (others may be added as desired).

\begin{description}
 \item [{\tt code}] The name of the group finding code used in the construction of these merger trees;
 \item [{\tt linkingLength}] For friends-of-friends group finding algorithms the dimensionless (i.e. in units of the mean interparticle spacing) linking length used;
 \item [{\tt minimumParticleNumber}] The minimum number of particles that a group was required to have in order to be included in a merger tree.
\end{description}

\section{Simulation Group}

This group, typically relevant only for merger trees derived from N-body simulations, describes the characteristics of the simulation from which the trees were derived. An example of this group, showing standard attributes, is given below.

\begin{verbatim}
 GROUP "simulation" {
   COMMENT "Simulation parameters."
   ATTRIBUTE "ErrTolIntAccuracy" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.02
      }
   }
   ATTRIBUTE "TypeOfTimestepCriterion" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "boxSize" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 500
      }
   }
   ATTRIBUTE "code" {
      DATATYPE  H5T_STRING {
            STRSIZE 8;
            STRPAD H5T_STR_SPACEPAD;
            CSET H5T_CSET_ASCII;
            CTYPE H5T_C_S1;
         }
      DATASPACE  SCALAR
      DATA {
      (0): "GADGET-2"
      }
   }
   ATTRIBUTE "initialConditions" {
      DATATYPE  H5T_STRING {
            STRSIZE 5;
            STRPAD H5T_STR_SPACEPAD;
            CSET H5T_CSET_ASCII;
            CTYPE H5T_C_S1;
         }
      DATASPACE  SCALAR
      DATA {
      (0): "glass"
      }
   }
   ATTRIBUTE "softeningKernel" {
      DATATYPE  H5T_STRING {
            STRSIZE 6;
            STRPAD H5T_STR_SPACEPAD;
            CSET H5T_CSET_ASCII;
            CTYPE H5T_C_S1;
         }
      DATASPACE  SCALAR
      DATA {
      (0): "spline"
      }
   }
   ATTRIBUTE "softeningPlummerEquivalent" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 0.005
      }
   }
   ATTRIBUTE "startRedshift" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 127
      }
   }
}
\end{verbatim}

\subsection{Standard Attributes}

The following are standard attributes in the {\tt simulation} group (others may be added as desired).

\begin{description}
 \item [{\tt boxSize}] Relevant for cubic volumes typical of cosmological simulations, this attributes gives the length of the box in whatever unit system the file used (see \S\ref{sec:UnitsGroup});
 \item [{\tt code}] The name of the code used to run the simulation;
 \item [{\tt initialConditions}] A description of the initial conditions;
 \item [{\tt softeningKernel}] A description of the softening kernel used;
 \item [{\tt softeningPlummerEquivalent}] The equivalent Plummer softening length;
 \item [{\tt startRedshift}] The redshift at which the simulation was begun.
\end{description}

\subsubsection{{\sc Gadget}-specific Standard Attributes}

The following are standard attributes in the {\tt simulation} group specifically relevant to simulations run with the \href{http://www.mpa-garching.mpg.de/gadget/}{{\sc Gadget}} code. They typically reflect the values of parameters used by that code.

\begin{description}
 \item [{\tt ErrTolIntAccuracy}] The integration accuracy used by {\sc Gadget};
 \item [{\tt TypeOfTimestepCriterion}] The type of timestepping criterion used by {\sc Gadget};
 \item [{\tt SofteningGas}] Specifies the (comoving) softening of the first particle group in {\sc Gadget};
 \item [{\tt SofteningHalo}] Specifies the (comoving) softening of the second particle group in {\sc Gadget};
 \item [{\tt SofteningDisk}] Specifies the (comoving) softening of the third particle group in {\sc Gadget};
 \item [{\tt SofteningBulge}] Specifies the (comoving) softening of the fourth particle group in {\sc Gadget};
 \item [{\tt SofteningStars}] Specifies the (comoving) softening of the fifth particle group in {\sc Gadget};
 \item [{\tt SofteningBndry}] Specifies the (comoving) softening of the sixth particle group in {\sc Gadget};
 \item [{\tt SofteningGasMaxPhys}] Specifies the maximum physical softening of the first particle group in {\sc Gadget};
 \item [{\tt SofteningHaloMaxPhys}] Specifies the maximum physical softening of the second particle group in {\sc Gadget};
 \item [{\tt SofteningDiskMaxPhys}] Specifies the maximum physical softening of the third particle group in {\sc Gadget};
 \item [{\tt SofteningBulgeMaxPhys}] Specifies the maximum physical softening of the fourth particle group in {\sc Gadget};
 \item [{\tt SofteningStarsMaxPhys}] Specifies the maximum physical softening of the fifth particle group in {\sc Gadget};
 \item [{\tt SofteningBndryMaxPhys}] Specifies the maximum physical softening of the sixth particle group in {\sc Gadget}.
\end{description}

\section{Units Group}\label{sec:UnitsGroup}

This group describes the unit system used throughout the file. Attributes should be included for length, mass and velocity units. In each case, three attributes are required to describe the units used (in the following {\tt quantity} refers to {\tt length}, {\tt mass}, {\tt time} or {\tt velocity}):
\begin{description}
 \item [{\tt quantityUnitsInSI}] The units of this quantity expressed in the SI system;
 \item [{\tt quantityHubbleExponent}] The exponent of the reduced Hubble constant, $h$, appearing in the units for this quantity;
 \item [{\tt quantityScaleFactorExponent}] The exponent, $n$,  of the expansion factor, $a$, required to convert this quantity into physical units. That is, multiplying this quantity by $a^n$ will give the quantity in physical units.
\end{description}
For example, if lengths in the file are expressed in units of comoving $h^{-1}$ Mpc, then we would have
\begin{verbatim}
 lengthUnitsInSI           =  3.08568e+22
 lengthHubbleExponent      = -1
 lengthScaleFactorExponent =  1
\end{verbatim}
This allows a code reading the data from a merger tree file to automatically convert it into whatever unit/coordinate system it chooses.

An example of this group, showing standard attributes, is given below.

\begin{verbatim}
   ATTRIBUTE "lengthHubbleExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): -1
      }
   }
   ATTRIBUTE "lengthScaleFactorExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 1
      }
   }
   ATTRIBUTE "lengthUnitsInSI" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 3.08568e+22
      }
   }
   ATTRIBUTE "massHubbleExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): -1
      }
   }
   ATTRIBUTE "massScaleFactorExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "massUnitsInSI" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 1.98892e+40
      }
   }
   ATTRIBUTE "timeHubbleExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "timeScaleFactorExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "timeUnitsInSI" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 3.1556926e+16
      }
   }
}   ATTRIBUTE "velocityHubbleExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "velocityScaleFactorExponent" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "velocityUnitsInSI" {
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SCALAR
      DATA {
      (0): 1000
      }
   }
}
\end{verbatim}

\section{Halo Trees Group}\label{sec:HaloTreesGroup}

The {\tt haloTrees} group contains the data describing the actual merger trees. Nodes from each tree must be stored contiguously. An example of this group is given below. In this example, {\tt $<$nodeCount$>$} is the total number of nodes in all merger trees.

\begin{verbatim}
GROUP "haloTrees" {
   ATTRIBUTE "haloMassesIncludeSubhalos" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "treesAreSelfContained" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 1
      }
   }
   ATTRIBUTE "treesHaveSubhalos" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 1
      }
   }
   ATTRIBUTE "velocitiesIncludeHubbleFlow" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   ATTRIBUTE "positionsArePeriodic" {
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SCALAR
      DATA {
      (0): 0
      }
   }
   DATASET "descendentIndex" {
   COMMENT "The index of each descendent node."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "expansionFactor" {
   COMMENT "The expansion factor of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "halfMassRadius" {
   COMMENT "The half mass radius of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "hostIndex" {
   COMMENT "The index of each host node."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "nodeIndex" {
   COMMENT "The index of each node."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "nodeMass" {
   COMMENT "The mass of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "particleCount" {
   COMMENT "The number of entries within the particles group for this node."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "particleStart" {
   COMMENT "The index within the particles group at which the particle data for this node is stored."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "position" {
   COMMENT "The position of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount>, 3 ) / ( <nodeCount>, 3 ) }
   }
   DATASET "scaleRadius" {
   COMMENT "The scale radius of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "redshift" {
   COMMENT "The redshift of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "spin" {
   COMMENT "The spin of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount>, 3 ) / ( <nodeCount>, 3 ) }
   }
   DATASET "time" {
   COMMENT "The time of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount> ) / ( <nodeCount> ) }
   }
   DATASET "velocity" {
   COMMENT "The velocity of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <nodeCount>, 3 ) / ( <nodeCount>, 3 ) }
   }
}
\end{verbatim}

\subsection{Standard Attributes}

The following are standard attributes in the {\tt haloTrees} group (others may be added as desired).

\begin{description}
 \item [{\tt haloMassesIncludeSubhalos}] Indicates whether or not the masses of halos include the masses of any subhalos that they may contain. A value of 0 implies that halo masses do not include masses of subhalos, while a value of 1 indicates that they do;
 \item [{\tt treesAreSelfContained}] Indicates whether or not trees are self-contained, in the sense that nodes never transfer from one tree to another. A value of 0 implies that nodes \emph{can} move from one tree to another, while a value of 1 implies that they can not;
 \item [{\tt treesHaveSubhalos}] Indicates whether or not trees contain information on subhalos. A value of 0 implies that they do not, while a value of 1 implies that they do. This attribute is a convenience, as subhalo presence can be determined from the node data directly;
 \item [{\tt velocitiesIncludeHubbleFlow}] Indicates whether or not velocities include the Hubble flow. A value of 0 indicates that they do not, while a value of 1 indicates that they do. See \S\ref{sec:GalacticusVelocityDefinitions} for important notes on velocity definitions in \glc.
 \item [{\tt positionsArePeriodic}] Indicates whether or not positions are periodic (as in a cosmological cube simulation). A value of 0 indicates that they are not, while a value of 1 indicates that they are periodic, with a period of {\tt boxSize}.
\end{description}

\subsection{Standard Datasets}

The following are standard datasets in the {\tt haloTrees} group.

\begin{description}
 \item [{\tt angularMomentum}] The angular momentum of the halo. This can be either the magnitude of the angular momentum or a 3-D vector;
 \item [{\tt expansionFactor}] The expansion factor (normalized to unity at the present day) at which this node is identified (note that only one of the {\tt expansionFactor}, {\tt redshift} and {\tt time} datasets is required, since they are simply related, but multiple \emph{can} be present);
 \item [{\tt descendentIndex}] The {\tt nodeIndex} of the descendent of this node in the merger tree, or $-1$ if there is no descendent;
 \item [{\tt halfMassRadius}] The radius containing half the mass of the node;
 \item [{\tt hostIndex}] The {\tt nodeIndex} of the node which hosts this node;
 \item [{\tt nodeIndex}] An ID number for the node, unique at least within each tree. If nodes are able to move from one tree to another, the ID must be unique within all trees. No other constraints are placed on {\tt nodeIndex} (e.g. it \emph{does not} have to be monotonically increasing within the file for example);
 \item [{\tt nodeMass}] The mass of the node;
 \item [{\tt position}] The three dimensional position of this node;
 \item [{\tt redshift}] The redshift at which this node is identified (note that only one of the {\tt expansionFactor}, {\tt redshift} and {\tt time} datasets is required, since they are simply related, but multiple \emph{can} be present);
 \item [{\tt scaleRadius}] The characteristic scale radius in the node (typically, but not necessarily, the NFW scale radius);
 \item [{\tt spin}] The spin parameter, $\lambda$, of the halo. This can be either the spin magnitude or a 3-D vector;
 \item [{\tt time}] The time at which this node is identified (note that only one of the {\tt expansionFactor}, {\tt redshift} and {\tt time} datasets is required, since they are simply related, but multiple \emph{can} be present);
 \item [{\tt velocity}] The three dimensional velocity of the node. See \S\ref{sec:GalacticusVelocityDefinitions} for important notes on velocity definitions in \glc;
 \item [{\tt particleIndex}] If the {\tt particles} group is included, this dataset should give the index of the first entry in the particle datasets that corresponds to the particle associated with this node;
 \item [{\tt particleCount}] If the {\tt particles} group is included, this dataset should give the number of entries in particle datasets that correspond to the particle associated with this node;
\end{description}

\section{Tree Index Group}

The {\tt treeIndex} group contains indexing information which describes which sections of the datasets in the {\tt haloTrees} group belong to each tree. An example of this group is given below.

\begin{verbatim}
GROUP "treeIndex" {
   DATASET "firstNode" {
   COMMENT "Position of the first node in each tree in the haloTrees datasets."
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SIMPLE { ( <treeCount> ) / ( <treeCount> ) }
   }
   DATASET "numberOfNodes" {
   COMMENT "Number of nodes in each tree."
      DATATYPE  H5T_STD_I32LE
      DATASPACE  SIMPLE { ( <treeCount> ) / ( <treeCount> ) }
   }
   DATASET "treeIndex" {
   COMMENT "Unique index of tree."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <treeCount> ) / ( <treeCount> ) }
   }
   DATASET "treeWeight" {
   COMMENT "The number of such trees required per unit volume to create a representative sample."
      DATATYPE  H5T_STD_F64LE
      DATASPACE  SIMPLE { ( <treeCount> ) / ( <treeCount> ) }
   }
}
\end{verbatim}

\subsection{Standard Datasets}

\begin{description}
 \item [{\tt firstNode}] For each tree, gives the position in the {\tt haloTrees} datasets of the first node in the tree (note that dataset indexing begins at 0). This \emph{does not} necessarily have to be the root node of the tree---nodes in a single tree can be stored in any order in the {\tt haloTrees} datasets, providing that they are contiguous;
 \item [{\tt numberOfNodes}] For each tree, gives the number of nodes in the tree;
 \item [{\tt treeIndex}] A unique ID number for each tree;
 \item [{\tt treeWeight}] A weight factor specifying the number density of each tree required to construct a representative sample. If not present, it is acceptable to assume that the weight is $1/${\tt boxSize}$^3$ if that attribute is present in the {\tt simulation} group.
\end{description}

\section{Merger Trees Group}

The {\tt mergerTrees} group is optional and provides a convenience method for accessing the properties of individual trees. If present, it contains one group for each tree in the file, named {\tt mergerTree<treeID>} where {\tt $<$treeID$>$} is the ID of the tree. Each of these groups should contain a set of scalar references to the sections of the datasets in the {\tt haloTrees} group to which this tree corresponds. For example, the {\tt descendentIndex} reference for the tree with ID number 89 would be as follows:

\begin{verbatim}
GROUP "mergerTrees/mergerTree89" {
   DATASET "descendentIndex" {
      DATATYPE  H5T_REFERENCE
      DATASPACE  SCALAR
      DATA {
         DATASET /haloTrees/descendentIndex {(<indexBegin>)-(<indexEnd>)}
      }
   }
}
\end{verbatim}

\section{Particles Group}

The {\tt particles} group is optional and contains information on particle trajectories. It is intended for use with merger tree derived from N-body simulations for which it is often useful to track the location of, for example, the most bound particle associated with a subhalo even after that subhalo can no longer be tracked in the simulation. An example of this group is given below. In this example, {\tt $<particleCount>$} is the total number of particles included in the group.

\begin{verbatim}
GROUP "particles" {
   DATASET "particleID" {
   COMMENT "The ID of each particle."
      DATATYPE  H5T_STD_I64LE
      DATASPACE  SIMPLE { ( <particleCount> ) / ( <particleCount> ) }
   }
   DATASET "redshift" {
   COMMENT "The redshift of each particle."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <particleCount> ) / ( <particleCount> ) }
   }
   DATASET "time" {
   COMMENT "The time of each particle."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <particleCount> ) / ( <particleCount> ) }
   }
   DATASET "expansionFactor" {
   COMMENT "The expansion factor of each particle."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <particleCount> ) / ( <particleCount> ) }
   }
   DATASET "position" {
   COMMENT "The position of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <particleCount>, 3 ) / ( <particleCount>, 3 ) }
   }
   DATASET "velocity" {
   COMMENT "The velocity of each node."
      DATATYPE  H5T_IEEE_F64LE
      DATASPACE  SIMPLE { ( <particleCount>, 3 ) / ( <particleCount>, 3 ) }
   }
}
\end{verbatim}

Each particle should be stored contiguously (i.e. entries with the same {\tt particleID} should be consecutive) and it is frequently convenient (although not required) that entries for each particle be arranged in order of increasing cosmic time.

\subsection{Standard Datasets}

\begin{description}
 \item [{\tt particleID}] An ID, unique within the entire simulation, for each particle;
 \item [{\tt redshift}] The redshift at which the particle is recorded (a single particle can appear in these datasets at multiple times);
 \item [{\tt time}] The time at which the particle is recorded (a single particle can appear in these datasets multiple times at different redshifts);
 \item [{\tt expansionFactor}] The expansion factor at which the particle is recorded (a single particle can appear in these datasets multiple times at different expansion factors);
 \item [{\tt position}] The spatial position of the particle;
 \item [{\tt velocity}] The velocity of the particle. See \S\ref{sec:GalacticusVelocityDefinitions} for important notes on velocity definitions in \glc.
\end{description}

Note that only one of the {\tt expansionFactor}, {\tt time} and {\tt redshift} datasets is required, as they are simply related, but multiple of them \emph{can} be present.
